<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>القهوة - شطرنج المحترفين</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="theme.js"></script>
    
    <style>
        /* Mobile Optimization */
        body { overscroll-behavior: none; }
        
        /* Game Layout Grid */
        .game-wrapper {
            display: grid;
            grid-template-columns: 1fr 300px; /* Board | Sidebar */
            gap: 20px;
            align-items: start;
            margin-top: 20px;
        }

        /* Board Area */
        .board-section {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        #myBoard {
            width: 100%;
            touch-action: none; 
            border: 5px solid var(--primary-blue);
            border-radius: 4px;
            box-shadow: var(--shadow-md);
        }

        /* Sidebar Area (Chat/History) */
        .game-sidebar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 15px;
            height: 600px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
        }

        /* Player Info Cards */
        .player-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(111, 78, 55, 0.05); /* Light Coffee Tint */
            border-radius: 8px;
        }
        
        .player-avatar {
            width: 45px; height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-color);
        }

        .captured-pieces {
            height: 20px;
            font-size: 14px;
            color: var(--text-grey);
            margin-top: 2px;
            display: flex;
            gap: 2px;
        }

        /* Move History Table */
        .history-container {
            flex: 1;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 15px 0;
            overflow-y: auto;
            padding: 5px;
            font-family: monospace;
            font-size: 0.95rem;
            direction: ltr; /* Chess notation is always LTR */
        }
        
        .move-row {
            display: flex;
            padding: 5px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .move-row:nth-child(even) { background: rgba(0,0,0,0.02); }
        .move-num { width: 30px; color: var(--text-grey); font-weight: bold; }
        .move-val { flex: 1; color: var(--text-dark); cursor: pointer; text-align: center; }
        .move-val:hover { color: var(--primary-blue); font-weight: bold; background: rgba(0,0,0,0.05); }

        /* Chess Board Visuals (Coffee Theme) */
        .square-55d63.white-1baca { background-color: #F5F5DC; color: #6F4E37; } /* Beige */
        .square-55d63.black-3c85d { background-color: #6F4E37; color: #F5F5DC; } /* Coffee Brown */

        .highlight-active { background-color: rgba(255, 215, 0, 0.5) !important; }
        
        .hint-dot {
            background: rgba(0,0,0,0.2);
            width: 25%; height: 25%; border-radius: 50%;
            position: absolute; top: 37.5%; left: 37.5%; pointer-events: none;
        }
        .capture-ring {
            border: 5px solid rgba(0,0,0,0.2);
            width: 85%; height: 85%; border-radius: 50%;
            position: absolute; top: 7.5%; left: 7.5%; pointer-events: none;
        }

        /* --- NEW CARDS UI STYLES --- */
        .game-options-container {
            text-align: center;
            padding: 2rem 1rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .section-title {
            color: var(--primary-blue, #6F4E37);
            font-size: 1.8rem;
            margin-bottom: 2rem;
            font-weight: 800;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            justify-content: center;
        }

        .game-card {
            background: var(--bg-card, #FFFFFF);
            border: 2px solid var(--border-color, #D2B48C);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .game-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary-blue, #6F4E37);
            box-shadow: 0 10px 20px rgba(111, 78, 55, 0.15);
            background: rgba(111, 78, 55, 0.03);
        }

        .card-icon {
            width: 70px;
            height: 70px;
            background-color: var(--bg-light, #F5F5DC);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            transition: 0.3s;
        }

        .card-icon i { font-size: 32px; color: var(--primary-blue, #6F4E37); }
        .game-card:hover .card-icon { background-color: var(--primary-blue, #6F4E37); }
        .game-card:hover .card-icon i { color: #F5F5DC; }

        .game-card h3 { font-size: 1.2rem; font-weight: bold; color: var(--text-dark, #2C1810); margin: 0; }
        .game-card p { font-size: 0.9rem; color: var(--text-grey, #6D6D6D); margin: 0; line-height: 1.4; }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .game-wrapper { grid-template-columns: 1fr; }
            .game-sidebar { height: auto; min-height: 200px; }
            .history-container { height: 150px; }
            .board-section { order: 1; }
            .game-sidebar { order: 2; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">القهوة ♟️</div>
        <ul class="nav-links">
            <li><a href="games.html"><i class="fa-solid fa-arrow-right"></i> رجوع للألعاب</a></li>
        </ul>
        <div class="nav-right" id="navAuth"></div>
    </nav>

    <div class="container">
        
        <div id="setupScreen">
            <div class="game-options-container">
                <h2 class="section-title">اختار طريقة اللعب ♟️</h2>
                
                <div class="cards-grid">
                    <div class="game-card" onclick="startGame('ai')">
                        <div class="card-icon"><i class="fa-solid fa-robot"></i></div>
                        <h3>ضد الذكاء (AI)</h3>
                        <p>درب نفسك وجرب تكسب الكمبيوتر</p>
                    </div>

                    <div class="game-card" onclick="startGame('local')">
                        <div class="card-icon"><i class="fa-solid fa-user-group"></i></div>
                        <h3>وجه لوجه (Local)</h3>
                        <p>العب أنت وصاحبـك على نفس الجهاز</p>
                    </div>

                    <div class="game-card" onclick="startGame('online')">
                        <div class="card-icon"><i class="fa-solid fa-globe"></i></div>
                        <h3>أونلاين (Online)</h3>
                        <p>تحدى أصحابك من أي مكان</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameArea" style="display:none;">
            <div class="game-wrapper">
                
                <div class="board-section">
                    <div class="player-card">
                        <img id="oppAvatar" src="images/user.png" class="player-avatar">
                        <div style="flex:1;">
                            <div id="oppName" style="font-weight:bold; color:var(--primary-blue);">الخصم</div>
                            <div id="oppCaptured" class="captured-pieces"></div>
                        </div>
                    </div>

                    <div id="myBoard"></div>

                    <div class="player-card">
                        <img id="myAvatar" src="images/user.png" class="player-avatar">
                        <div style="flex:1;">
                            <div id="myName" style="font-weight:bold; color:var(--primary-blue);">أنا</div>
                            <div id="myCaptured" class="captured-pieces"></div>
                        </div>
                    </div>
                </div>

                <div class="game-sidebar">
                    <div class="status-box" id="status" style="text-align:center;">جاهز للعب...</div>
                    
                    <h4 style="margin-top:10px; color:var(--text-grey);">سجل النقلات</h4>
                    <div id="moveHistory" class="history-container">
                        </div>

                    <div style="margin-top:auto; display:flex; flex-direction:column; gap:10px;">
                        <button class="btn-primary" id="shareBtn" style="display:none;" onclick="shareGameLink()">
                            <i class="fa-solid fa-share-nodes"></i> دعوة صديق
                        </button>
                        <button class="btn-outline" onclick="window.location.href='games-chess.html'">
                        <!-- <button class="btn-outline" onclick="window.location.reload()"> -->
                            <i class="fa-solid fa-rotate-right"></i> لعبة جديدة
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="inviteModal" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">تحدي صديق ♟️</h3>
            <div id="inviteList" style="max-height:200px; overflow-y:auto; border:1px solid #eee; margin-bottom:15px; border-radius:8px;"></div>
            <button class="btn-outline" onclick="document.getElementById('inviteModal').style.display='none'">إغلاق</button>
        </div>
    </div>

    <audio id="sndMove" src="https://images.chesscomfiles.com/chess-themes/sounds/_common/default/move-self.mp3"></audio>
    <audio id="sndCapture" src="https://images.chesscomfiles.com/chess-themes/sounds/_common/default/capture.mp3"></audio>
    <audio id="sndNotify" src="https://images.chesscomfiles.com/chess-themes/sounds/_common/default/notify.mp3"></audio>
    <audio id="sndWin" src="https://images.chesscomfiles.com/chess-themes/sounds/_common/default/game-end.mp3"></audio>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script type="module" src="games-chess.js"></script>

</body>
</html>